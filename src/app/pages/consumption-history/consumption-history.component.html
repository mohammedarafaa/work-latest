<section class="main-content pt-2 pt-sm-3 pt-md-4 mt-5 pb-2 pb-sm-3 pb-md-4 px-2 px-sm-3 px-lg-4">
  <!-- DASHBOARD MODE: Show all meters, allow selection -->
  <div *ngIf="mode === 'dashboard'">
    <!-- Filter Section -->
    <div class="filter-section mb-4 p-4">
      <h2 class="mb-3">{{ "dashboardTemp.yourMeters" | translate }}</h2>
      
      <form class="row g-3 align-items-end" [formGroup]="form" autocomplete="off">
        <div class="col-12 col-md-6 col-lg-3">
          <label for="compoundId" class="form-label">{{ "compound" | translate }}</label>
          <ng-select [items]="projectList | async" bindValue="id" bindLabel="name" class="custom"
            placeholder="{{ 'compound_place' | translate }}" formControlName="compoundId" [clearable]="true">
            <ng-option *ngFor="let project of (projectList | async)" [value]="project.id">
              <i class="fas fa-building me-2"></i>
              {{ project.name }}
            </ng-option>
          </ng-select>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label for="propertyId" class="form-label">{{ "Property_Number" | translate }}</label>
          <ng-select [items]="propertyList | async" bindValue="id" bindLabel="name" class="custom"
            placeholder="{{ 'property_number_place' | translate }}" formControlName="propertyId" [clearable]="true">
            <ng-option *ngFor="let property of (propertyList | async)" [value]="property.id">
              <i class="fas fa-home me-2"></i>
              {{ property.id }}
            </ng-option>
          </ng-select>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label for="meterType" class="form-label">{{ "charge.meterType" | translate }}</label>
          <ng-select [items]="meterTypes" class="custom" placeholder="{{ 'meterType_place' | translate }}"
            formControlName="meterType" [clearable]="true">
            <ng-option *ngFor="let type of meterTypes" [value]="type">
              <i [ngClass]="getIcons(type)" class="me-2"></i>
              {{ type | translate }}
            </ng-option>
          </ng-select>
        </div>
        <div class="col-12 col-md-6 col-lg-3 d-grid gap-2">
          <button type="button" class="btn btn-primary" (click)="applyFilters()" [disabled]="isApplyingFilters">
            <i class="fas fa-search me-1"></i>
            {{ "dashboardTemp.applyFilters" | translate }}
            <span *ngIf="isApplyingFilters" class="spinner-border spinner-border-sm ms-2"></span>
          </button>
          <button type="button" class="btn btn-outline-secondary" (click)="resetFilters()">
            <i class="fas fa-refresh me-1"></i>
            {{ "Reset_Filters" | translate }}
          </button>
        </div>
      </form>
    </div>

    <!-- Meters Page Size Selector -->
    <div class="row align-items-center mb-3" *ngIf="!isLoading && totalItems > 0">
      <div class="col-12 col-md-6 mb-2 mb-md-0">
        <div class="d-flex align-items-center">
          <label class="form-label me-2 mb-0">{{ 'Items_Per_Page' | translate }}:</label>
          <select class="form-select form-select-sm" style="width: 70px;" 
                  [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="text-muted small text-md-end">
          {{ 'Showing' | translate }} {{ (currentPage - 1) * pageSize + 1 }} to 
          {{ Math.min(currentPage * pageSize, totalItems) }} 
          of {{ totalItems }} {{ 'Entries' | translate }}
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary mb-3" style="width:3rem;height:3rem;"></div>
      <h5>{{ 'Loading' | translate }}…</h5>
      <p class="text-muted small" *ngIf="isApplyingFilters">{{ "Applying_Filters" | translate }}...</p>
    </div>

    <!-- No Meters Found -->
    <div class="no-meters-found" *ngIf="!isLoading && (!meterList || meterList.length === 0)">
      <div class="text-center py-5">
        <div class="empty-state">
          <i class="fas fa-search fa-4x text-muted mb-4"></i>
          <h4>{{ 'No_Meters_Found' | translate }}</h4>
          <p class="text-muted">{{ 'No_Meters_Match_Current_Filters' | translate }}</p>
          <button class="btn btn-outline-primary btn-xl" (click)="resetFilters()">
            <i class="fas fa-refresh me-1"></i>
            {{ 'Reset_Filters' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Meters Grid -->
    <div class="meters-section my-5" *ngIf="!isLoading && meterList && meterList.length > 0">
      <div class="row gy-4 gx-3">
        <div class="col-12 col-sm-6 col-lg-4" *ngFor="let meter of meterList; trackBy: trackByMeterId">
          
          <!-- Meter Card -->
          <div class="meter-card" 
            [class.meter-card-selected]="isMeterSelected(meter)"
            [class.border-primary]="isMeterSelected(meter)" 
            [class.shadow-lg]="isMeterSelected(meter)"
            (click)="onMeterCardClick(meter)"
            style="cursor: pointer;">
            
            <!-- Selection indicator -->
            <div class="selection-indicator" *ngIf="isMeterSelected(meter)">
              <span class="badge bg-primary position-absolute top-0 end-0 m-2 z-3">
                <i class="fas fa-check-circle me-1"></i>
                {{ 'Selected' | translate }}
              </span>
              <div class="selection-ring"></div>
            </div>

            <div class="meter-header" [ngClass]="meter.type">
              <div class="meter-info-box">
                <div class="meter-type-section">
                  <div class="meter-type d-flex align-items-center justify-content-start">
                    <i class="text-white me-3" [ngClass]="getIcons(meter.type)"></i>
                    <span class="meter-type-text text-white">{{ meter.type | translate }}</span>
                  </div>
                </div>
                <div class="meter-serial-section">
                  <span class="meter-serial-text text-white">{{ meter.meterSerial }}</span>
                </div>
              </div>
            </div>
            
            <div class="meter-body">
              <!-- Location Section -->
              <div class="location-section">
                <div class="location-content d-flex justify-content-between align-items-center">
                  <span class="location-label">{{ 'dashboardThree.location' | translate }}:</span>
                  <span class="location-value">{{ meter.block }}, {{ meter.propertyNo }}</span>
                </div>
              </div>
              
              <!-- Current Balance Section -->
              <div class="balance-section">
                <div class="balance-content d-flex justify-content-between align-items-center">
                  <div class="balance-label">{{ 'currentBalance' | translate }}</div>
                  <div class="balance-value">{{ meter.availableCredit | number }} {{ 'EGP' | translate }}</div>
                </div>
              </div>
              
              <!-- Progress Bar -->
              <div class="progress-section">
                <div class="progress">
                  <div class="progress-bar bg-success" role="progressbar"
                       [style.width.%]="getProgressWidth(meter.availableCredit)"
                       [attr.aria-valuenow]="meter.availableCredit" aria-valuemin="0" aria-valuemax="1000">
                  </div>
                </div>
              </div>
              
              <!-- Last Month Usage Section -->
              <div class="consumption-section">
                <div class="consumption-content d-flex justify-content-between align-items-center">
                  <span class="consumption-label">{{ 'Meter_Reading' | translate }}</span>
                  <span class="consumption-value">
                    {{ meter.meterReading | number }} {{ getUnitOfMeasure(meter.type) }}
                  </span>
                </div>
              </div>
            </div>
            
            <div class="meter-footer">
              <!-- View History button that acts as card selection -->
              <button class="btn btn-view-history"
                      [class.btn-success]="isMeterSelected(meter)"
                      [class.btn-primary]="!isMeterSelected(meter)"
                      (click)="onViewHistoryClick(meter, $event)">
                <i class="fas fa-chart-line me-2"></i>
                {{ isMeterSelected(meter) ? ('Selected' | translate) : ('View_History' | translate) }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap Pagination for Meters -->
    <div class="pt-2 pt-sm-3 pt-md-4" *ngIf="!isLoading && totalItems > pageSize">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 gap-md-3">
        <div class="text-muted small text-center text-md-start order-2 order-md-1">
          <span class="d-block d-sm-inline">
            {{ 'Showing' | translate }} {{ (currentPage - 1) * pageSize + 1 }} to 
            {{ Math.min(currentPage * pageSize, totalItems) }} 
            of {{ totalItems }} {{ 'Entries' | translate }}
          </span>
        </div>
        <div class="order-1 order-md-2">
          <ngb-pagination 
            *ngIf="!isLoading"
            [collectionSize]="totalItems" 
            [(page)]="currentPage"
            [maxSize]="5" 
            [pageSize]="pageSize" 
            (pageChange)="onPageChange($event)" 
            [rotate]="true" 
            [boundaryLinks]="true"
            size="sm"
            class="mb-0">
          </ngb-pagination>
        </div>
      </div>
    </div>

    <!-- Consumption Chart/Table Section -->
    <div class="consumption-section mt-5" #chartSection *ngIf="selectedMeter && !isLoading">
      <div class="card shadow-sm">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
              <div class="d-flex align-items-center gap-3 flex-wrap">
                <h5 class="card-title mb-0">{{ 'Consumption_History' | translate }}</h5>
                
                <!-- Months Selector -->
                <ng-select [items]="monthsOptions" 
                          bindLabel="label" 
                          bindValue="value"
                          [ngModel]="selectedMonths" 
                          (ngModelChange)="onMonthsChange($event)"
                          class="custom months-selector" 
                          style="min-width: 120px;"
                          [clearable]="false">
                  <ng-option *ngFor="let month of monthsOptions" [value]="month.value">
                    {{ month.label | translate }}
                  </ng-option>
                </ng-select>
              </div>
            </div>
            
            <!-- Chart/Table Toggle -->
            <div class="col-12 col-lg-6">
              <div class="btn-group btn-group-sm w-100 w-lg-auto justify-content-lg-end">
                <button type="button" 
                  class="btn" 
                  [class.btn-primary]="!showTableView"
                  [class.btn-outline-primary]="showTableView" 
                  (click)="toggleDataView('chart')">
                  <i class="fas fa-chart-bar me-1"></i>
                  {{ 'Chart_View' | translate }}
                </button>
                <button type="button" 
                  class="btn" 
                  [class.btn-primary]="showTableView"
                  [class.btn-outline-primary]="!showTableView" 
                  (click)="toggleDataView('table')">
                  <i class="fas fa-table me-1"></i>
                  {{ 'Table_View' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Selected Meter Info -->
        <div class="card-body">
          <div class="alert border-0 shadow-sm mb-3 meter-info-enhanced" 
               [ngClass]="{
                 'meter-info-water': selectedMeter?.type === 'WATER',
                 'meter-info-electricity': selectedMeter?.type === 'ELECTRICITY', 
                 'meter-info-gas': selectedMeter?.type === 'GAS',
                 'meter-info-default': !selectedMeter?.type || (selectedMeter?.type !== 'WATER' && selectedMeter?.type !== 'ELECTRICITY' && selectedMeter?.type !== 'GAS')
               }">
            <div class="d-flex align-items-center">
              <i class="fas fa-tachometer-alt fa-2x me-3" 
                 [ngClass]="{
                   'text-white': selectedMeter?.type,
                   'text-primary': !selectedMeter?.type
                 }"></i>
              <div>
                <h6 class="mb-1 fw-bold">{{ 'Selected_Meter' | translate }}</h6>
                <div class="d-flex flex-wrap gap-3">
                  <span><strong>{{ 'Serial' | translate }}:</strong> {{ selectedMeter.meterSerial }}</span>
                  <span><strong>{{ 'Type' | translate }}:</strong> {{ selectedMeter.type | translate }}</span>
                  <span><strong>{{ 'Location' | translate }}:</strong> {{ selectedMeter.block }}, {{ selectedMeter.propertyNo }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingMeterChart" class="text-center py-5">
            <div class="spinner-border text-primary mb-3" style="width:2rem;height:2rem;"></div>
            <h6>{{ 'Loading' | translate }}…</h6>
            <p class="text-muted small">{{ 'Please_Wait' | translate }}</p>
          </div>

          <!-- Error State -->
          <div *ngIf="!isLoadingMeterChart && meterChartError" class="alert alert-danger text-center">
            <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
            <h5 class="alert-heading">{{ 'Error' | translate }}</h5>
            <p class="mb-0">{{ meterChartError | translate }}</p>
          </div>

          <!-- Table View with Pagination ONLY in Table Mode -->
          <div *ngIf="!isLoadingMeterChart && !meterChartError && showTableView && dailyConsumptionTable.length > 0">
            
            <!-- Table Controls with Page Size Selector (ONLY SHOW IN TABLE VIEW) -->
            <div class="row align-items-center mb-3">
              <div class="col-12 col-md-6 mb-2 mb-md-0">
                <div class="d-flex align-items-center">
                  <label class="form-label me-2 mb-0 small">{{ 'Records_Per_Page' | translate }}:</label>
                  <select class="form-select form-select-sm" 
                    style="width: 70px;" 
                    [ngModel]="dataPageSize" 
                    (ngModelChange)="onDataPageSizeChange($event)">
                    <option *ngFor="let size of dataPageSizeOptions" [value]="size">{{ size }}</option>
                  </select>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small text-md-end">
                  {{ 'Showing' | translate }} {{ (dataCurrentPage - 1) * dataPageSize + 1 }} to 
                  {{ Math.min(dataCurrentPage * dataPageSize, dataTotalItems) }} 
                  of {{ dataTotalItems }} {{ 'Entries' | translate }}
                </div>
              </div>
            </div>

            <!-- Desktop Table -->
            <div class="d-none d-md-block">
              <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                  <thead class="table-primary">
                    <tr>
                      <th scope="col" class="text-nowrap">
                        <i class="fas fa-calendar me-1"></i>
                        {{ "Date" | translate }}
                      </th>
                      <th scope="col" class="text-nowrap">
                        <i class="fas fa-tachometer-alt me-1"></i>
                        {{ "Meter_Reading" | translate }}
                      </th>
                      <th scope="col" class="text-nowrap">
                        <i class="fas fa-wallet me-1"></i>
                        {{ "Available_Credit" | translate }}
                      </th>
                      <th scope="col" class="text-nowrap">
                        <i class="fas fa-chart-line me-1"></i>
                        {{ "Daily_Usage" | translate }}
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let record of paginatedTableData; trackBy: trackByDate">
                      <td class="fw-medium">{{ record.date }}</td>
                      <td>
                        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
                          {{ record.meterReading | number : "1.2-2" }}
                          <small class="ms-1">{{ getUnitOfMeasure(selectedMeter?.type || "") }}</small>
                        </span>
                      </td>
                      <td>
                        <span class="text-success fw-bold">
                          {{ record.availableCredit | number : "1.2-2" }}
                          <small class="text-muted ms-1">{{ "EGP" | translate }}</small>
                        </span>
                      </td>
                      <td>
                        <span [class]="getDailyUsageClass(record.dailyUsage)" class="fw-bold">
                          {{ record.dailyUsage | number : "1.2-2" }}
                          <small class="ms-1">{{ getUnitOfMeasure(selectedMeter?.type || "") }}</small>
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Mobile Cards -->
            <div class="d-block d-md-none">
              <div class="row g-3">
                <div class="col-12" *ngFor="let record of paginatedTableData; trackBy: trackByDate">
                  <div class="card border-0 shadow-sm">
                    <div class="card-body p-3">
                      <div class="row align-items-center">
                        <div class="col-12 mb-2">
                          <div class="d-flex justify-content-between align-items-center">
                            <h6 class="card-title mb-0 text-primary">
                              <i class="fas fa-calendar me-1"></i>
                              {{ record.date }}
                            </h6>
                            <span class="badge bg-primary fs-6">
                              {{ record.meterReading | number : "1.2-2" }}
                              {{ getUnitOfMeasure(selectedMeter?.type || "") }}
                            </span>
                          </div>
                        </div>
                        <div class="col-6">
                          <small class="text-muted d-block">{{ "Available_Credit" | translate }}</small>
                          <span class="text-success fw-bold">
                            {{ record.availableCredit | number : "1.2-2" }} {{ "EGP" | translate }}
                          </span>
                        </div>
                        <div class="col-6">
                          <small class="text-muted d-block">{{ "Daily_Usage" | translate }}</small>
                          <span [class]="getDailyUsageClass(record.dailyUsage)" class="fw-bold">
                            {{ record.dailyUsage | number : "1.2-2" }}
                            {{ getUnitOfMeasure(selectedMeter?.type || "") }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Table Pagination (ONLY SHOWN IN TABLE VIEW) -->
            <div class="pt-2 pt-sm-3 pt-md-4" *ngIf="shouldShowPagination()">
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 gap-md-3">
                <div class="text-muted small text-center text-md-start order-2 order-md-1">
                  <span class="d-block d-sm-inline">
                    {{ 'Showing' | translate }} {{ (dataCurrentPage - 1) * dataPageSize + 1 }} to 
                    {{ Math.min(dataCurrentPage * dataPageSize, dataTotalItems) }} 
                    of {{ dataTotalItems }} {{ 'Entries' | translate }}
                  </span>
                </div>
                <div class="order-1 order-md-2">
                  <ngb-pagination *ngIf="!isLoadingMeterChart" 
                                 [collectionSize]="dataTotalItems" 
                                 [(page)]="dataCurrentPage"
                                 [maxSize]="5" 
                                 [pageSize]="dataPageSize" 
                                 (pageChange)="onDataPageChange($event)" 
                                 [rotate]="true" 
                                 [boundaryLinks]="true"
                                 size="sm"
                                 class="mb-0">
                  </ngb-pagination>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart View WITHOUT Pagination -->
          <div class="chart-container" style="height: 450px; width: 100%;"
               *ngIf="!isLoadingMeterChart && !meterChartError && !showTableView && meterChartData.length > 0">
            <highcharts-chart [Highcharts]="Highcharts" [options]="meterChartOptions"
              style="width: 100%; height: 100%; display: block;">
            </highcharts-chart>

            <!-- NO PAGINATION FOR CHART VIEW - Show total record count instead -->
            <div class="pt-3" *ngIf="meterChartData.length > 0">
              <div class="text-center">
                <small class="text-muted">
                  {{ 'Displaying_All_Data' | translate }}: {{ meterChartData.length }} {{ 'Records' | translate }}
                </small>
              </div>
            </div>
          </div>

          <!-- No Data State -->
          <div *ngIf="!isLoadingMeterChart && !meterChartError && meterChartData.length === 0 && dailyConsumptionTable.length === 0"
               class="text-center py-5">
            <div class="empty-state">
              <i class="fas fa-chart-line fa-4x text-muted mb-4"></i>
              <h4>{{ 'No_Data_Available' | translate }}</h4>
              <p class="text-muted">{{ 'No_Data_For_This_Meter' | translate }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SINGLE METER MODE: Show only selected meter's history -->
  <div *ngIf="mode === 'single'">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="javascript:void(0)" (click)="goBackToAllMeters()" class="text-decoration-none">
            <i class="fas fa-tachometer-alt me-1"></i>
            {{ "All_Meters" | translate }}
          </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          {{ "Meter_Details" | translate }}
        </li>
      </ol>
    </nav>

    <!-- Single Meter Chart/Table Content -->
    <div class="consumption-section" #chartSection *ngIf="selectedMeter">
      <!-- Loading State -->
      <div *ngIf="isLoadingMeterChart" class="text-center py-5">
        <div class="spinner-border text-primary mb-3" style="width: 2rem; height: 2rem"></div>
        <h6 class="text-muted">{{ "Loading_Consumption_Data" | translate }}...</h6>
      </div>

      <!-- Error State -->
      <div *ngIf="!isLoadingMeterChart && meterChartError" class="alert alert-danger text-center">
        <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
        <h5 class="alert-heading">{{ "Error" | translate }}</h5>
        <p class="mb-0">{{ meterChartError | translate }}</p>
      </div>

      <!-- Chart/Table content for single meter -->
      <div class="card shadow-sm" *ngIf="!isLoadingMeterChart && !meterChartError">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
              <h5 class="card-title mb-0">
                {{ "Consumption_History_For_Serial" | translate }}: {{ selectedMeter.meterSerial }}
              </h5>
            </div>
            
            <div class="col-12 col-lg-6">
              <div class="row align-items-center">
                <div class="col-12 col-md-6 mb-2 mb-md-0">
                  <div class="d-flex align-items-center">
                    <label class="form-label me-2 mb-0 small fw-semibold">{{ 'Period' | translate }}:</label>
                    <ng-select [items]="monthsOptions" 
                               bindLabel="label" 
                               bindValue="value"
                               [(ngModel)]="selectedMonths" 
                               (ngModelChange)="onMonthsChange($event)"
                               class="custom months-selector" 
                               style="min-width: 120px;"
                               [clearable]="false">
                      <ng-option *ngFor="let month of monthsOptions" [value]="month.value">
                        {{ month.label | translate }}
                      </ng-option>
                    </ng-select>
                  </div>
                </div>
                
                <div class="col-12 col-md-6">
                  <div class="btn-group btn-group-sm w-100">
                    <button type="button" class="btn" [class.btn-primary]="!showTableView"
                            [class.btn-outline-primary]="showTableView" (click)="toggleDataView('chart')">
                      <i class="fas fa-chart-line me-1"></i>
                      <span class="d-none d-md-inline">{{ "Chart_View" | translate }}</span>
                      <span class="d-md-none">{{ "Chart" | translate }}</span>
                    </button>
                    <button type="button" class="btn" [class.btn-primary]="showTableView"
                            [class.btn-outline-primary]="!showTableView" (click)="toggleDataView('table')">
                      <i class="fas fa-table me-1"></i>
                      <span class="d-none d-md-inline">{{ "Table_View" | translate }}</span>
                      <span class="d-md-none">{{ "Table" | translate }}</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-body">
          <!-- Same table and chart content as dashboard mode -->
          <div *ngIf="showTableView && dailyConsumptionTable.length > 0">
            <!-- Table Controls with Page Size Selector (ONLY IN TABLE VIEW) -->
            <div class="row align-items-center mb-3">
              <div class="col-12 col-md-6 mb-2 mb-md-0">
                <div class="d-flex align-items-center">
                  <label class="form-label me-2 mb-0 small">{{ 'Records_Per_Page' | translate }}:</label>
                  <select class="form-select form-select-sm" 
                    style="width: 70px;" 
                    [ngModel]="dataPageSize" 
                    (ngModelChange)="onDataPageSizeChange($event)">
                    <option *ngFor="let size of dataPageSizeOptions" [value]="size">{{ size }}</option>
                  </select>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small text-md-end">
                  {{ 'Showing' | translate }} {{ (dataCurrentPage - 1) * dataPageSize + 1 }} to 
                  {{ Math.min(dataCurrentPage * dataPageSize, dataTotalItems) }} 
                  of {{ dataTotalItems }} {{ 'Entries' | translate }}
                </div>
              </div>
            </div>

            <!-- Same table structure as dashboard mode -->
            <div class="table-responsive">
              <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                  <tr>
                    <th scope="col" class="text-nowrap">
                      <i class="fas fa-calendar me-1"></i>
                      {{ "Date" | translate }}
                    </th>
                    <th scope="col" class="text-nowrap">
                      <i class="fas fa-tachometer-alt me-1"></i>
                      {{ "Meter_Reading" | translate }}
                    </th>
                    <th scope="col" class="text-nowrap">
                      <i class="fas fa-wallet me-1"></i>
                      {{ "Available_Credit" | translate }}
                    </th>
                    <th scope="col" class="text-nowrap">
                      <i class="fas fa-chart-line me-1"></i>
                      {{ "Daily_Usage" | translate }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let record of paginatedTableData; trackBy: trackByDate">
                    <td class="fw-medium">{{ record.date }}</td>
                    <td>
                      <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
                        {{ record.meterReading | number : "1.2-2" }}
                        <small class="ms-1">{{ getUnitOfMeasure(selectedMeter?.type || "") }}</small>
                      </span>
                    </td>
                    <td>
                      <span class="text-success fw-bold">
                        {{ record.availableCredit | number : "1.2-2" }}
                        <small class="text-muted ms-1">{{ "EGP" | translate }}</small>
                      </span>
                    </td>
                    <td>
                      <span [class]="getDailyUsageClass(record.dailyUsage)" class="fw-bold">
                        {{ record.dailyUsage | number : "1.2-2" }}
                        <small class="ms-1">{{ getUnitOfMeasure(selectedMeter?.type || "") }}</small>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Table Pagination (ONLY SHOWN IN TABLE VIEW) -->
            <div class="pt-2 pt-sm-3 pt-md-4" *ngIf="shouldShowPagination()">
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 gap-md-3">
                <div class="text-muted small text-center text-md-start order-2 order-md-1">
                  <span class="d-block d-sm-inline">
                    {{ 'Showing' | translate }} {{ (dataCurrentPage - 1) * dataPageSize + 1 }} to 
                    {{ Math.min(dataCurrentPage * dataPageSize, dataTotalItems) }} 
                    of {{ dataTotalItems }} {{ 'Entries' | translate }}
                  </span>
                </div>
                <div class="order-1 order-md-2">
                  <ngb-pagination *ngIf="!isLoadingMeterChart" 
                                 [collectionSize]="dataTotalItems" 
                                 [(page)]="dataCurrentPage"
                                 [maxSize]="5" 
                                 [pageSize]="dataPageSize" 
                                 (pageChange)="onDataPageChange($event)" 
                                 [rotate]="true" 
                                 [boundaryLinks]="true"
                                 size="sm"
                                 class="mb-0">
                  </ngb-pagination>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="!showTableView && meterChartData.length > 0">
            <div class="chart-container" style="min-height: 450px; width: 100%">
              <highcharts-chart [Highcharts]="Highcharts" [options]="meterChartOptions"
                style="width: 100%; height: 100%; display: block;">
              </highcharts-chart>
              
              <!-- Show total records count for chart view -->
              <div class="pt-3">
                <div class="text-center">
                  <small class="text-muted">
                    {{ 'Displaying_All_Data' | translate }}: {{ meterChartData.length }} {{ 'Records' | translate }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
